<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>–¢–µ—Å—Ç Mini App</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, sans-serif;
            padding: 20px;
            background: var(--tg-theme-bg-color, #ffffff);
            color: var(--tg-theme-text-color, #000000);
            min-height: 100vh;
        }
        .container { max-width: 400px; margin: 0 auto; }
        h1 { margin-bottom: 20px; font-size: 24px; }
        .card {
            background: var(--tg-theme-secondary-bg-color, #f2f2f2);
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 15px;
        }
        button {
            width: 100%;
            padding: 14px;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            margin: 10px 0;
            cursor: pointer;
            transition: 0.2s;
        }
        .btn-primary {
            background: var(--tg-theme-button-color, #40a7e3);
            color: var(--tg-theme-button-text-color, #ffffff);
        }
        .btn-secondary {
            background: var(--tg-theme-secondary-bg-color, #e0e0e0);
            color: var(--tg-theme-text-color, #000000);
        }
        button:active { transform: scale(0.98); }
        .info { margin: 10px 0; padding: 10px; background: #e3f2fd; border-radius: 8px; }
        .theme-light { background: #f8f9fa; color: #212529; }
        .theme-dark { background: #1a1a1a; color: #ffffff; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üß™ –¢–µ—Å—Ç Mini App</h1>
        
        <div class="card">
            <h3>üë§ –ò–Ω—Ñ–æ –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ:</h3>
            <div id="user-info">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
        </div>

        <div class="card">
            <h3>üé® –¢–µ–º–∞:</h3>
            <div id="theme-info">–û–ø—Ä–µ–¥–µ–ª—è–µ–º...</div>
        </div>

        <div class="card">
            <h3>üì± –ü–ª–∞—Ç—Ñ–æ—Ä–º–∞:</h3>
            <div id="platform-info">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
        </div>

        <button class="btn-primary" onclick="showAlert()">
            üîî –ü–æ–∫–∞–∑–∞—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
        </button>

        <button class="btn-secondary" onclick="toggleExpand()">
            üì± –†–∞–∑–≤–µ—Ä–Ω—É—Ç—å/–°–≤–µ—Ä–Ω—É—Ç—å
        </button>

        <button class="btn-primary" onclick="sendToBot()">
            üì§ –û—Ç–ø—Ä–∞–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –±–æ—Ç—É
        </button>

        <button class="btn-secondary" onclick="closeApp()">
            ‚ùå –ó–∞–∫—Ä—ã—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
        </button>

        <div class="info" id="log">
            –ñ—É—Ä–Ω–∞–ª —Å–æ–±—ã—Ç–∏–π –ø–æ—è–≤–∏—Ç—Å—è –∑–¥–µ—Å—å...
        </div>
    </div>

    <script>
        // ========== –û–°–ù–û–í–ù–û–ô –ö–û–î MINI APP ==========
        const tg = window.Telegram.WebApp;
        
        // 1. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        function init() {
            log('Mini App –∑–∞–ø—É—â–µ–Ω!');
            
            // –†–∞–∑–≤–æ—Ä–∞—á–∏–≤–∞–µ–º –Ω–∞ –≤–µ—Å—å —ç–∫—Ä–∞–Ω
            tg.expand();
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ
            showUserInfo();
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–µ–º—É
            showTheme();
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–ª–∞—Ç—Ñ–æ—Ä–º—É
            showPlatform();
            
            // –°–æ–æ–±—â–∞–µ–º Telegram —á—Ç–æ –≥–æ—Ç–æ–≤—ã
            tg.ready();
            log('–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≥–æ—Ç–æ–≤–æ –∫ —Ä–∞–±–æ—Ç–µ');
        }

        // 2. –ü–æ–∫–∞–∑–∞—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ
        function showUserInfo() {
            const user = tg.initDataUnsafe.user;
            if (user) {
                document.getElementById('user-info').innerHTML = `
                    <strong>–ò–º—è:</strong> ${user.first_name || '–ù–µ —É–∫–∞–∑–∞–Ω–æ'}<br>
                    <strong>–§–∞–º–∏–ª–∏—è:</strong> ${user.last_name || '–ù–µ —É–∫–∞–∑–∞–Ω–∞'}<br>
                    <strong>Username:</strong> @${user.username || '–Ω–µ—Ç'}<br>
                    <strong>ID:</strong> ${user.id}
                `;
                log(`–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: ${user.first_name} (@${user.username})`);
            } else {
                document.getElementById('user-info').innerHTML = '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω';
                log('–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω');
            }
        }

        // 3. –ü–æ–∫–∞–∑–∞—Ç—å —Ç–µ–º—É
        function showTheme() {
            const theme = tg.colorScheme;
            document.getElementById('theme-info').innerHTML = `
                <strong>–¢–µ–º–∞:</strong> ${theme === 'dark' ? 'üåô –¢—ë–º–Ω–∞—è' : '‚òÄÔ∏è –°–≤–µ—Ç–ª–∞—è'}<br>
                <strong>–¶–≤–µ—Ç —Ñ–æ–Ω–∞:</strong> ${tg.themeParams.bg_color || '–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é'}
            `;
            
            // –ú–µ–Ω—è–µ–º –∫–ª–∞—Å—Å –¥–ª—è –¥–µ–º–æ
            document.body.className = theme === 'dark' ? 'theme-dark' : 'theme-light';
        }

        // 4. –ü–æ–∫–∞–∑–∞—Ç—å –ø–ª–∞—Ç—Ñ–æ—Ä–º—É
        function showPlatform() {
            const platform = tg.platform;
            document.getElementById('platform-info').innerHTML = `
                <strong>–ü–ª–∞—Ç—Ñ–æ—Ä–º–∞:</strong> ${platform}<br>
                <strong>–í–µ—Ä—Å–∏—è:</strong> ${tg.version}
            `;
        }

        // 5. –ü–æ–∫–∞–∑–∞—Ç—å –≤—Å–ø–ª—ã–≤–∞—é—â–µ–µ –æ–∫–Ω–æ
        function showAlert() {
            tg.showAlert('–ü—Ä–∏–≤–µ—Ç –æ—Ç Mini App! üéâ');
            log('–ü–æ–∫–∞–∑–∞–Ω–æ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ');
        }

        // 6. –†–∞–∑–≤–µ—Ä–Ω—É—Ç—å/—Å–≤–µ—Ä–Ω—É—Ç—å
        let isExpanded = true;
        function toggleExpand() {
            if (isExpanded) {
                tg.close();
                log('–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Å–≤—ë—Ä–Ω—É—Ç–æ');
            } else {
                tg.expand();
                log('–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Ä–∞–∑–≤—ë—Ä–Ω—É—Ç–æ');
            }
            isExpanded = !isExpanded;
        }

        // 7. –û—Ç–ø—Ä–∞–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –±–æ—Ç—É
        function sendToBot() {
            const data = {
                action: 'test',
                timestamp: new Date().toISOString(),
                user_id: tg.initDataUnsafe.user?.id
            };
            
            tg.sendData(JSON.stringify(data));
            tg.showAlert('–î–∞–Ω–Ω—ã–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã –±–æ—Ç—É!');
            log('–î–∞–Ω–Ω—ã–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã –±–æ—Ç—É: ' + JSON.stringify(data));
        }

        // 8. –ó–∞–∫—Ä—ã—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
        function closeApp() {
            tg.close();
            log('–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∑–∞–∫—Ä—ã—Ç–æ');
        }

        // 9. –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ (–¥–ª—è –æ—Ç–ª–∞–¥–∫–∏)
        function log(message) {
            const logDiv = document.getElementById('log');
            const time = new Date().toLocaleTimeString();
            logDiv.innerHTML = `[${time}] ${message}<br>` + logDiv.innerHTML;
        }

        // 10. –°–ª—É—à–∞–µ–º —Å–æ–±—ã—Ç–∏—è
        tg.onEvent('themeChanged', showTheme);
        tg.onEvent('viewportChanged', () => log('–†–∞–∑–º–µ—Ä –æ–∫–Ω–∞ –∏–∑–º–µ–Ω—ë–Ω'));

        // –ó–∞–ø—É—Å–∫–∞–µ–º –∫–æ–≥–¥–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –∑–∞–≥—Ä—É–∑–∏—Ç—Å—è
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>